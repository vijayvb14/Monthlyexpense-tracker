<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Expense Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  margin: 0;
  font-family: Arial;
  background: linear-gradient(135deg,#1e3c72,#c31432);
  min-height: 100vh;
}

.app {
  background: white;
  max-width: 420px;
  margin: auto;
  padding: 15px;
  border-radius: 16px;
}

label {
  font-size: 13px;
  font-weight: bold;
  margin-top: 10px;
  display: block;
}

input, select, button {
  width: 100%;
  padding: 10px;
  margin-top: 6px;
}

button {
  background: #333;
  color: white;
  border: none;
  border-radius: 10px;
}

.section {
  background: #f4f6fa;
  padding: 10px;
  border-radius: 10px;
  margin-top: 10px;
}

#bottomNav {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: #111;
  display: flex;
  justify-content: space-around;
  padding: 8px 0;
}

#bottomNav button {
  background: none;
  color: white;
  font-size: 18px;
}
</style>
</head>

<body>

<div class="app">

<!-- ================= TRACKER ================= -->
<div id="tracker">
  <h3>üí∞ Expense Tracker</h3>

  <label>Month</label>
  <input type="month" id="month">

  <label>Type</label>
  <select id="type" onchange="loadCategories(); loadBalance();">
    <option>Personal</option>
    <option>Office</option>
    <option>House Build</option>
  </select>

  <label>Category</label>
  <select id="category"></select>

  <label>Monthly Budget</label>
  <input type="number" id="budget">

  <label>Amount</label>
  <input type="number" id="amount">

  <button onclick="addAmount()">‚ûï Add Amount</button>
  <button onclick="spendAmount()">üí∏ Spend</button>

  <div class="section">
    <b>Balance:</b> ‚Çπ <span id="balance">0</span>
  </div>

  <button onclick="downloadExcel()">üì§ Download Excel</button>
</div>

<!-- ================= CHARTS ================= -->
<div id="charts" style="display:none;">
  <h3>üìà Trends</h3>

  <label>Trend Type</label>
  <select onchange="switchTrend(this.value)">
    <option value="personal">Personal</option>
    <option value="office">Office</option>
    <option value="house">House Build</option>
  </select>

  <canvas id="trendChart" height="220"></canvas>
</div>

</div>

<!-- MOBILE NAV -->
<div id="bottomNav">
  <button onclick="showSection('tracker')">üè†</button>
  <button onclick="showSection('charts')">üìä</button>
</div>

<script>
/* ================= CONFIG ================= */
const API_URL = "PASTE_YOUR_WEB_APP_URL";
const SHEET_ID = "14DntGpbPle9sA2jonUKSA14JzUixUG4Kx5etfNNSIok";

/* ================= CATEGORY MAP ================= */
const categoryMap = {
  Personal: ["Food","Rent","Friends","Home","Others"],

  Office: ["Card","Game"],

  "House Build": [
    "Borewell Work",
    "EB",
    "Loan",
    "Service Wire",
    "Sand",
    "3/4 Jali",
    "Motor and Pipe",
    "Pipe Work",
    "JCB Pillar Work Bore",
    "Iron",
    "Switch Board",
    "Cement",
    "Jali",
    "Cement Bricks",
    "Gravel",
    "Earth Beam",
    "Brick",
    "Red Face Brick",
    "Wood Work",
    "JCB Septic Tank",
    "Vehicle",
    "River Sand",
    "Door Clamp",
    "Loan CR",
    "Loan DR",
    "PF",
    "Salary",
    "Miscellaneous"
  ]
};


/* ================= STATE ================= */
let balance = 0;
let chart;
let excelData;

/* ================= INIT ================= */
month.value = new Date().toISOString().slice(0,7);
loadCategories();
loadBalance();

/* ================= UI NAV ================= */
function showSection(id) {
  tracker.style.display = "none";
  charts.style.display = "none";
  document.getElementById(id).style.display = "block";

  if (id === "charts") loadExcelData();
}

/* ================= TRACKER LOGIC ================= */
function loadCategories() {
  category.innerHTML = "";
  categories[type.value].forEach(c =>
    category.add(new Option(c, c))
  );
}

function storageKey() {
  return type.value === "House Build"
    ? "HB_BALANCE"
    : `${month.value}_${type.value}`;
}

function loadBalance() {
  balance = Number(localStorage.getItem(storageKey()) || 0);
  document.getElementById("balance").innerText = balance;
}

function updateBalance(v) {
  balance = v;
  localStorage.setItem(storageKey(), v);
  document.getElementById("balance").innerText = v;
}

function addAmount() {
  const amt = Number(amount.value);
  processTxn(amt, 0);
}

function spendAmount() {
  const amt = Number(amount.value);
  processTxn(0, amt);

  if (budget.value && balance < budget.value * 0.3) {
    alert("‚ö†Ô∏è Budget almost used");
  }
}

function processTxn(cr, dr) {
  const newBal = balance + cr - dr;
  updateBalance(newBal);

  fetch(API_URL, {
    method: "POST",
    headers: { "Content-Type": "text/plain;charset=utf-8" },
    body: JSON.stringify({
      month: month.value,
      type: type.value,
      category: category.value,
      credit: cr,
      debit: dr,
      balance: newBal
    })
  });
}

function downloadExcel() {
  window.open(`https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=xlsx`);
}

/* ================= EXCEL DATA ================= */
function loadExcelData() {
  if (excelData) return;
  fetch(API_URL)
    .then(r => r.json())
    .then(d => {
      excelData = d;
      drawPersonalTrend();
    });
}

/* ================= TREND SWITCH ================= */
function switchTrend(v) {
  if (v === "personal") drawPersonalTrend();
  if (v === "office") drawOfficeTrend();
  if (v === "house") drawHouseTrend();
}

/* ================= CHARTS ================= */
function drawPersonalTrend() {
  drawLine(
    excelData.summary.Personal,
    "Personal Monthly Spend"
  );
}

function drawOfficeTrend() {
  drawLine(
    excelData.summary.Office,
    "Office Monthly Spend"
  );
}

function drawHouseTrend() {
  const labels = ["House Build"];
  const values = [excelData.summary.HouseBuild.debit];

  if (chart) chart.destroy();
  chart = new Chart(trendChart, {
    type: "bar",
    data: {
      labels,
      datasets: [{
        label: "House Build Total Spend",
        data: values,
        backgroundColor: "#4caf50"
      }]
    }
  });
}

function drawLine(obj, label) {
  const labels = [];
  const values = [];

  Object.keys(obj).sort().forEach(m => {
    labels.push(m);
    values.push(obj[m].debit);
  });

  if (chart) chart.destroy();
  chart = new Chart(trendChart, {
    type: "line",
    data: {
      labels,
      datasets: [{
        label,
        data: values,
        borderColor: "#ff9800",
        fill: false,
        tension: 0.3
      }]
    }
  });
}
</script>

</body>
</html>

